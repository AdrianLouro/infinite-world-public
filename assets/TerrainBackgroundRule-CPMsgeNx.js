import{d as V,e as U,k as P,u as X,o as s,c as u,l as i,n as y,m as E,i as C,F as w,g as O,v as A,t as m,p as S,q as R,_ as Y,s as F,x as J,h as M}from"./index--uw6PT5T.js";const H=(a,t,o)=>a.toSorted((e,l)=>o(e).localeCompare(o(l))).reduce((e,l)=>({...e,[t(l)]:o(l)}),{});class T{constructor(t,o){this.x=t,this.y=o}static create(t,o){return new T(t,o)}static fromPrimitives(t){return new T(t.x,t.y)}toPrimitives(){return{x:this.x,y:this.y}}equalsTo(t){return this.x===t.x&&this.y===t.y}}const bt=["water","mountain","forest","plain","desert","swamp","glacier","tundra"],ft=["1","2"],Q=["orc_city","orc_fortress","human_city","human_fortress","dwarven_city","dwarven_fortress","elven_city","elven_fortress","goblin_city","gnome_city","ruins","volcano","rocks","reef","portal","oasis","thin_ice"],G=["palace","crypt","tomb","sanctuary","temple","prison","sewers","citadel","pyramid","ziggurat","laboratory","necropolis","entrails","mega_dungeon","cave"];let $=class D{constructor(t=null,o=0,n=null,e=null,l=null,v=!1,k){this.terrain=t,this.terrainRotation=o,this.location=n,this.dungeon=e,this.notes=l,this.isCurrent=v,this.coordinates=k}static at(t,o){return new D(null,0,null,null,null,!1,T.create(t,o))}static fromPrimitives(t){return new D(t.terrain,t.terrainRotation??0,t.location,t.dungeon,t.notes??null,t.isCurrent??!1,T.fromPrimitives(t.coordinates))}toPrimitives(){return{terrain:this.terrain,terrainRotation:this.terrainRotation,location:this.location,dungeon:this.dungeon,notes:this.notes,isCurrent:this.isCurrent,coordinates:this.coordinates.toPrimitives()}}rotateTerrain(){this.terrainRotation=(this.terrainRotation+90)%360}};var K=(a=>(a.Hexagon="hexagon",a.Square="square",a))(K||{});const Z={class:"land__content"},tt={class:"info"},ot={value:null},et=["value"],nt={value:null},rt=["value"],at={value:null},st=["value"],it={class:"bottom-actions"},lt=V({__name:"Land",props:{terrainsBackgroundRules:{type:Array,required:!0},terrainsOptions:{type:Object,required:!0},land:{type:Object,required:!0},shape:{type:String,required:!0},showLocations:{type:Boolean,required:!0},showDungeons:{type:Boolean,required:!0},showRotateButton:{type:Boolean,required:!0},showNotesButton:{type:Boolean,required:!0}},emits:["dblclick","rotateTerrainClick"],setup(a,{emit:t}){const o=a,n=U(),e=t,l=P(()=>o.terrainsBackgroundRules.find(r=>r.appliesFor(o.land))),v=P(()=>{var r;return((r=l.value)==null?void 0:r.backgroundType)==="color"}),k=P(()=>{var r;return((r=l.value)==null?void 0:r.backgroundType)==="image"}),q=()=>{e("dblclick")},L=()=>{e("rotateTerrainClick")},x=()=>{alert(`Notes: ${o.land.notes}`)},{t:p}=X({useScope:"global"}),h=H(Q,r=>r,r=>p(`location.${r}`)),g=H(G,r=>r,r=>p(`dungeon.${r}`));return(r,d)=>{var B,_,I,W,z;return s(),u("div",{class:y(["land",{"land--current":o.land.isCurrent,[`land--${o.land.terrain}`]:o.land.terrain,[`land--${o.shape}`]:o.shape,[`land--background-type-${(B=l.value)==null?void 0:B.backgroundType}`]:(_=l.value)==null?void 0:_.backgroundType}]),style:E({backgroundColor:v.value?(I=l.value)==null?void 0:I.background:"transparent ",borderColor:v.value?(W=l.value)==null?void 0:W.background:"transparent"})},[i("div",Z,[i("div",{class:y(["terrain-image",{[`terrain-image--rotation-${o.land.terrainRotation}`]:o.land.terrainRotation}]),style:E({backgroundImage:k.value?`url(${(z=l.value)==null?void 0:z.background})`:"transparent"})},null,6),i("div",tt,[C(n).showHud?(s(),u(w,{key:0},[O(i("select",{"onUpdate:modelValue":d[0]||(d[0]=c=>o.land.terrain=c)},[i("option",ot,m(`<${r.$t("label.terrain")}>`),1),(s(!0),u(w,null,S(o.terrainsOptions,(c,b,f)=>(s(),u("option",{key:f,value:b},m(c),9,et))),128))],512),[[A,o.land.terrain]]),o.showLocations?O((s(),u("select",{key:0,"onUpdate:modelValue":d[1]||(d[1]=c=>o.land.location=c)},[i("option",nt,m(`<${r.$t("label.location")}>`),1),(s(!0),u(w,null,S(C(h),(c,b,f)=>(s(),u("option",{key:f,value:b},m(c),9,rt))),128))],512)),[[A,o.land.location]]):R("",!0),o.showDungeons?O((s(),u("select",{key:1,"onUpdate:modelValue":d[2]||(d[2]=c=>o.land.dungeon=c)},[i("option",at,m(`<${r.$t("label.dungeon")}>`),1),(s(!0),u(w,null,S(C(g),(c,b,f)=>(s(),u("option",{key:f,value:b},m(c),9,st))),128))],512)),[[A,o.land.dungeon]]):R("",!0)],64)):R("",!0)]),i("div",it,[C(n).showHud&&o.showRotateButton?(s(),u("div",{key:0,class:"rotate-button",onClick:d[3]||(d[3]=c=>L())})):R("",!0),i("div",{class:"coordinates",onDblclick:d[4]||(d[4]=c=>q())},m(o.land.coordinates.x+" / "+o.land.coordinates.y),33),C(n).showHud&&o.showNotesButton?(s(),u("div",{key:1,class:y(["notes-button",{"notes-button--empty":!o.land.notes}]),onClick:d[5]||(d[5]=c=>x())},null,2)):R("",!0)])])],6)}}}),dt=Y(lt,[["__scopeId","data-v-e5011390"]]);let j=class N{constructor(t){this.lands=t}static ofSize(t){const o=$.at(0,0);o.isCurrent=!0;const n=new N([[o]]);return Array(t-1).fill(void 0).forEach(()=>{n.addTopRow(),n.addRightColumn(),n.addBottomRow(),n.addLeftColumn()}),n}static fromPrimitives(t){return new N(t.lands.map(o=>o.map(n=>$.fromPrimitives(n))))}toPrimitives(){return{lands:this.lands.map(t=>t.map(o=>o.toPrimitives()))}}addTopRow(){const t=this.lands[0][0].coordinates.y-1;this.lands.unshift(this.newRowAt(t))}addBottomRow(){const t=this.lands[this.lands.length-1][0].coordinates.y+1;this.lands.push(this.newRowAt(t))}addLeftColumn(){const t=this.lands[0][0].coordinates.x-1,o=this.lands[0][0].coordinates.y;this.lands.forEach((n,e)=>{n.unshift($.at(t,o+e))})}addRightColumn(){const t=this.lands[0][this.lands[0].length-1].coordinates.x+1,o=this.lands[0][0].coordinates.y;this.lands.forEach((n,e)=>{n.push($.at(t,o+e))})}movePlayersTo(t){this.lands.flat().forEach(o=>{o.isCurrent=o.coordinates.equalsTo(t)})}rotateTerrainAt(t){this.findLandAt(t).rotateTerrain()}findLandAt(t){const o=this.lands.flat().find(n=>n.coordinates.equalsTo(t));if(o===void 0)throw new Error(`Could not find land at ${t}`);return o}newRowAt(t){const o=this.lands[0][0].coordinates.x;return Array(this.lands[0].length).fill(void 0).map((n,e)=>$.at(o+e,t))}};const ut=()=>({save:ct,get:ht}),ct=a=>{localStorage.setItem("world",JSON.stringify(a.toPrimitives()))},ht=()=>pt(),pt=()=>{const a=localStorage.getItem("world");return a?j.fromPrimitives(JSON.parse(a)):null},gt={class:"top"},mt={class:"center"},vt={class:"lands"},wt={class:"bottom"},yt=V({__name:"World",props:{terrainsOptions:{type:Object,required:!0},terrainsBackgroundRules:{type:Array,required:!0},landShape:{type:String,required:!0},showLocations:{type:Boolean,required:!0},showDungeons:{type:Boolean,required:!0},showRotateButton:{type:Boolean,required:!0},showNotesButton:{type:Boolean,required:!0},initialSize:{type:Number,required:!0}},setup(a){const t=a,o=ut(),e=F(o.get()??j.ofSize(t.initialSize));J(e,p=>{o.save(p)});const l=()=>{e.addTopRow()},v=()=>{e.addBottomRow()},k=()=>{e.addLeftColumn()},q=()=>{e.addRightColumn()},L=p=>{e.movePlayersTo(p)},x=p=>{e.rotateTerrainAt(p)};return(p,h)=>(s(),u("div",{class:y(["world",{[`world--${t.landShape}`]:t.landShape}])},[i("div",gt,[i("div",{class:"add-button",onClick:h[0]||(h[0]=g=>l())},"+")]),i("div",mt,[i("div",{class:y(["add-button",{"add-button--margin-right-square":t.landShape==="square"&&e.lands.length>1,"add-button--margin-right-hexagon":t.landShape==="hexagon"&&e.lands.length>1}]),onClick:h[1]||(h[1]=g=>k())}," + ",2),i("div",vt,[(s(!0),u(w,null,S(e.lands,(g,r)=>(s(),u("div",{key:r,class:y(["row",{"row--margin-left-square":t.landShape==="square"&&e.lands.length>1,"row--margin-left-hexagon":t.landShape==="hexagon"&&g[0].coordinates.y%2!==0}])},[(s(!0),u(w,null,S(g,(d,B)=>(s(),M(dt,{key:B,land:d,"terrains-options":a.terrainsOptions,"terrains-background-rules":a.terrainsBackgroundRules,shape:t.landShape,"show-locations":t.showLocations,"show-dungeons":t.showDungeons,"show-rotate-button":t.showRotateButton,"show-notes-button":t.showNotesButton,onDblclick:_=>L(d.coordinates),onRotateTerrainClick:_=>x(d.coordinates)},null,8,["land","terrains-options","terrains-background-rules","shape","show-locations","show-dungeons","show-rotate-button","show-notes-button","onDblclick","onRotateTerrainClick"]))),128))],2))),128))]),i("div",{class:"add-button",onClick:h[2]||(h[2]=g=>q())},"+")]),i("div",wt,[i("div",{class:"add-button",onClick:h[3]||(h[3]=g=>v())},"+")])],2))}}),Ct=Y(yt,[["__scopeId","data-v-3536f971"]]),Rt=(a,t)=>({appliesFor:a,background:t,backgroundType:"color"}),$t=(a,t)=>({appliesFor:a,background:t,backgroundType:"image"});export{K as L,Ct as W,Rt as a,$t as b,H as c,ft as d,bt as n};
