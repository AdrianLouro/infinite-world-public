import{d as V,e as U,k as X,l as F,u as J,o as s,c as l,m as i,n as y,p as H,i as b,F as p,g as O,v as A,t as v,q as T,s as C,_ as Y,x as M,y as Q,h as _}from"./index-CpgVzEL5.js";const N=(e,t,o)=>e.toSorted((n,c)=>o(n).localeCompare(o(c))).reduce((n,c)=>({...n,[t(c)]:o(c)}),{});class ${constructor(t,o){this.x=t,this.y=o}static create(t,o){return new $(t,o)}static fromPrimitives(t){return new $(t.x,t.y)}toPrimitives(){return{x:this.x,y:this.y}}equalsTo(t){return this.x===t.x&&this.y===t.y}}const bt=["water","mountain","forest","plain","desert","swamp","glacier","tundra"],Ct=["1","2"],G=["orc_city","orc_fortress","human_city","human_fortress","dwarven_city","dwarven_fortress","elven_city","elven_fortress","goblin_city","gnome_city","ruins","volcano","rocks","reef","portal","oasis","thin_ice"],K=["palace","crypt","tomb","sanctuary","temple","prison","sewers","citadel","pyramid","ziggurat","laboratory","necropolis","entrails","mega_dungeon","cave"];let R=class I{constructor(t=null,o=0,a=null,n=null,c=!1,h){this.terrain=t,this.terrainRotation=o,this.location=a,this.dungeon=n,this.isCurrent=c,this.coordinates=h}static at(t,o){return new I(null,0,null,null,!1,$.create(t,o))}static fromPrimitives(t){return new I(t.terrain,t.terrainRotation??0,t.location,t.dungeon,t.isCurrent??!1,$.fromPrimitives(t.coordinates))}toPrimitives(){return{terrain:this.terrain,terrainRotation:this.terrainRotation,location:this.location,dungeon:this.dungeon,isCurrent:this.isCurrent,coordinates:this.coordinates.toPrimitives()}}rotateTerrain(){this.terrainRotation=(this.terrainRotation+90)%360}};var Z=(e=>(e.Hexagon="hexagon",e.Square="square",e))(Z||{});const tt={class:"land__content"},ot={class:"info"},et={value:null},nt=["value"],at={value:null},rt=["value"],st={value:null},it=["value"],lt={class:"bottom-actions"},dt=V({__name:"Land",props:{terrainsBackgroundRules:{type:Array,required:!0},terrainsOptions:{type:Object,required:!0},land:{type:Object,required:!0},shape:{type:String,required:!0},showLocations:{type:Boolean,required:!0},showDungeons:{type:Boolean,required:!0},showRotateButton:{type:Boolean,required:!0},showToggleInfoButton:{type:Boolean,required:!0}},emits:["dblclick","rotateTerrainClick"],setup(e,{emit:t}){const o=e,a=U(),n=t,c=X(!0),h=F(()=>o.terrainsBackgroundRules.find(r=>r.appliesFor(o.land))),L=()=>{n("dblclick")},x=()=>{n("rotateTerrainClick")},P=()=>{c.value=!c.value},{t:B}=J({useScope:"global"}),m=N(G,r=>r,r=>B(`location.${r}`)),g=N(K,r=>r,r=>B(`dungeon.${r}`));return(r,d)=>{var w,S,q,W,z,E;return s(),l("div",{class:y(["land",{"land--current":e.land.isCurrent,[`land--${e.land.terrain}`]:e.land.terrain,[`land--${o.shape}`]:o.shape}]),style:H({backgroundColor:((w=h.value)==null?void 0:w.backgroundType)==="color"?(S=h.value)==null?void 0:S.background:"transparent ",borderColor:((q=h.value)==null?void 0:q.backgroundType)==="color"?(W=h.value)==null?void 0:W.background:"transparent"})},[i("div",tt,[i("div",{class:y(["terrain-image",{[`terrain-image--rotation-${e.land.terrainRotation}`]:e.land.terrainRotation}]),style:H({backgroundImage:((z=h.value)==null?void 0:z.backgroundType)==="image"?`url(${(E=h.value)==null?void 0:E.background})`:"transparent"})},null,6),i("div",ot,[b(a).showHud&&c.value?(s(),l(p,{key:0},[O(i("select",{"onUpdate:modelValue":d[0]||(d[0]=u=>e.land.terrain=u)},[i("option",et,v(`<${r.$t("label.terrain")}>`),1),(s(!0),l(p,null,T(o.terrainsOptions,(u,f,k)=>(s(),l("option",{key:k,value:f},v(u),9,nt))),128))],512),[[A,e.land.terrain]]),o.showLocations?O((s(),l("select",{key:0,"onUpdate:modelValue":d[1]||(d[1]=u=>e.land.location=u)},[i("option",at,v(`<${r.$t("label.location")}>`),1),(s(!0),l(p,null,T(b(m),(u,f,k)=>(s(),l("option",{key:k,value:f},v(u),9,rt))),128))],512)),[[A,e.land.location]]):C("",!0),o.showDungeons?O((s(),l("select",{key:1,"onUpdate:modelValue":d[2]||(d[2]=u=>e.land.dungeon=u)},[i("option",st,v(`<${r.$t("label.dungeon")}>`),1),(s(!0),l(p,null,T(b(g),(u,f,k)=>(s(),l("option",{key:k,value:f},v(u),9,it))),128))],512)),[[A,e.land.dungeon]]):C("",!0)],64)):C("",!0)]),i("div",lt,[b(a).showHud&&o.showRotateButton?(s(),l("div",{key:0,class:"rotate-button",onClick:d[3]||(d[3]=u=>x())})):C("",!0),i("div",{class:"coordinates",onDblclick:d[4]||(d[4]=u=>L())},v(e.land.coordinates.x+" / "+e.land.coordinates.y),33),b(a).showHud&&o.showToggleInfoButton?(s(),l("div",{key:1,class:y(["toggle-info-button",{"toggle-info-button--hide":!c.value}]),onClick:d[5]||(d[5]=u=>P())},null,2)):C("",!0)])])],6)}}}),ut=Y(dt,[["__scopeId","data-v-eb21e81c"]]);let j=class D{constructor(t){this.lands=t}static ofSize(t){const o=R.at(0,0);o.isCurrent=!0;const a=new D([[o]]);return Array(t-1).fill(void 0).forEach(()=>{a.addTopRow(),a.addRightColumn(),a.addBottomRow(),a.addLeftColumn()}),a}static fromPrimitives(t){return new D(t.lands.map(o=>o.map(a=>R.fromPrimitives(a))))}toPrimitives(){return{lands:this.lands.map(t=>t.map(o=>o.toPrimitives()))}}addTopRow(){const t=this.lands[0][0].coordinates.y-1;this.lands.unshift(this.newRowAt(t))}addBottomRow(){const t=this.lands[this.lands.length-1][0].coordinates.y+1;this.lands.push(this.newRowAt(t))}addLeftColumn(){const t=this.lands[0][0].coordinates.x-1,o=this.lands[0][0].coordinates.y;this.lands.forEach((a,n)=>{a.unshift(R.at(t,o+n))})}addRightColumn(){const t=this.lands[0][this.lands[0].length-1].coordinates.x+1,o=this.lands[0][0].coordinates.y;this.lands.forEach((a,n)=>{a.push(R.at(t,o+n))})}movePlayersTo(t){this.lands.flat().forEach(o=>{o.isCurrent=o.coordinates.equalsTo(t)})}rotateTerrainAt(t){this.findLandAt(t).rotateTerrain()}findLandAt(t){const o=this.lands.flat().find(a=>a.coordinates.equalsTo(t));if(o===void 0)throw new Error(`Could not find land at ${t}`);return o}newRowAt(t){const o=this.lands[0][0].coordinates.x;return Array(this.lands[0].length).fill(void 0).map((a,n)=>R.at(o+n,t))}};const ct=()=>({save:ht,get:gt}),ht=e=>{localStorage.setItem("world",JSON.stringify(e.toPrimitives()))},gt=()=>mt(),mt=()=>{const e=localStorage.getItem("world");return e?j.fromPrimitives(JSON.parse(e)):null},vt={class:"top"},wt={class:"center"},pt={class:"lands"},yt={class:"bottom"},ft=V({__name:"World",props:{terrainsOptions:{type:Object,required:!0},terrainsBackgroundRules:{type:Array,required:!0},landShape:{type:String,required:!0},showLocations:{type:Boolean,required:!0},showDungeons:{type:Boolean,required:!0},showRotateButton:{type:Boolean,required:!0},showToggleInfoButton:{type:Boolean,required:!0},initialSize:{type:Number,required:!0}},setup(e){const t=e,o=ct(),n=M(o.get()??j.ofSize(t.initialSize));Q(n,m=>{o.save(m)});const c=()=>{n.addTopRow()},h=()=>{n.addBottomRow()},L=()=>{n.addLeftColumn()},x=()=>{n.addRightColumn()},P=m=>{n.movePlayersTo(m)},B=m=>{n.rotateTerrainAt(m)};return(m,g)=>(s(),l("div",{class:y(["world",{[`world--${t.landShape}`]:t.landShape}])},[i("div",vt,[i("div",{class:"add-button",onClick:g[0]||(g[0]=r=>c())},"+")]),i("div",wt,[i("div",{class:y(["add-button",{"add-button--margin-right-square":t.landShape==="square"&&n.lands.length>1,"add-button--margin-right-hexagon":t.landShape==="hexagon"&&n.lands.length>1}]),onClick:g[1]||(g[1]=r=>L())}," + ",2),i("div",pt,[(s(!0),l(p,null,T(n.lands,(r,d)=>(s(),l("div",{key:d,class:y(["row",{"row--margin-left-square":t.landShape==="square"&&n.lands.length>1,"row--margin-left-hexagon":t.landShape==="hexagon"&&r[0].coordinates.y%2!==0}])},[(s(!0),l(p,null,T(r,(w,S)=>(s(),_(ut,{key:S,land:w,"terrains-options":e.terrainsOptions,"terrains-background-rules":e.terrainsBackgroundRules,shape:t.landShape,"show-locations":t.showLocations,"show-dungeons":t.showDungeons,"show-rotate-button":t.showRotateButton,"show-toggle-info-button":t.showToggleInfoButton,onDblclick:q=>P(w.coordinates),onRotateTerrainClick:q=>B(w.coordinates)},null,8,["land","terrains-options","terrains-background-rules","shape","show-locations","show-dungeons","show-rotate-button","show-toggle-info-button","onDblclick","onRotateTerrainClick"]))),128))],2))),128))]),i("div",{class:"add-button",onClick:g[2]||(g[2]=r=>x())},"+")]),i("div",yt,[i("div",{class:"add-button",onClick:g[3]||(g[3]=r=>h())},"+")])],2))}}),Rt=Y(ft,[["__scopeId","data-v-a38016af"]]),Tt=(e,t)=>({appliesFor:e,background:t,backgroundType:"color"}),$t=(e,t)=>({appliesFor:e,background:t,backgroundType:"image"});export{Z as L,Rt as W,Tt as a,$t as b,N as c,Ct as d,bt as n};
