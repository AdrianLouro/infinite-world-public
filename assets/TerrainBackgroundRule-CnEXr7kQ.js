import{d as W,o as d,c as u,k as a,g as S,v as F,l as J,n as w,_ as z,e as K,m as Q,p as P,u as G,q as Y,i as b,F as k,s as A,t as y,x as T,y as B,z as Z,a as tt,A as et,B as ot,C as nt,h as rt}from"./index-D-V8cZO-.js";const M=(n,t,e)=>n.toSorted((o,p)=>e(o).localeCompare(e(p))).reduce((o,p)=>({...o,[t(p)]:e(p)}),{});class q{constructor(t,e){this.x=t,this.y=e}static create(t,e){return new q(t,e)}static fromPrimitives(t){return new q(t.x,t.y)}toPrimitives(){return{x:this.x,y:this.y}}equalsTo(t){return this.x===t.x&&this.y===t.y}}const xt=["water","mountain","forest","plain","desert","swamp","glacier","tundra"],Ot=["1","2"],st=["orc_city","orc_fortress","human_city","human_fortress","dwarven_city","dwarven_fortress","elven_city","elven_fortress","goblin_city","gnome_city","ruins","volcano","rocks","reef","portal","oasis","thin_ice"],at=["palace","crypt","tomb","sanctuary","temple","prison","sewers","citadel","pyramid","ziggurat","laboratory","necropolis","entrails","mega_dungeon","cave"];let $=class N{constructor(t=null,e=0,r=null,o=null,p=null,i=!1,h){this.terrain=t,this.terrainRotation=e,this.location=r,this.dungeon=o,this.notes=p,this.isCurrent=i,this.coordinates=h}static at(t,e){return new N(null,0,null,null,null,!1,q.create(t,e))}static fromPrimitives(t){return new N(t.terrain??null,t.terrainRotation??0,t.location??null,t.dungeon??null,t.notes??null,t.isCurrent??!1,q.fromPrimitives(t.coordinates))}toPrimitives(){return{terrain:this.terrain,terrainRotation:this.terrainRotation,location:this.location,dungeon:this.dungeon,notes:this.notes,isCurrent:this.isCurrent,coordinates:this.coordinates.toPrimitives()}}rotateTerrain(){this.terrainRotation=(this.terrainRotation+90)%360}};var it=(n=>(n.Hexagon="hexagon",n.Square="square",n))(it||{});const lt=W({__name:"LandNotesBubble",props:{land:{type:Object,required:!0},direction:{type:String,required:!0}},emits:["hide"],setup(n,{emit:t}){const e=n,r=t,o=()=>{r("hide")};return(p,i)=>(d(),u("div",{class:w(["land-notes-bubble",{[`land-notes-bubble--direction-${e.direction}`]:e.direction}])},[a("div",{class:"hide-button",onClick:i[0]||(i[0]=h=>o())},"âœ•"),S(a("textarea",{"onUpdate:modelValue":i[1]||(i[1]=h=>e.land.notes=h),onKeyup:i[2]||(i[2]=J(h=>o(),["esc"]))},null,544),[[F,e.land.notes]])],2))}}),dt=z(lt,[["__scopeId","data-v-22d61cfa"]]);var D=(n=>(n.Top="top",n.Bottom="bottom",n))(D||{});const ut={class:"land__content"},ct={class:"info"},pt={value:null},ht=["value"],gt={value:null},mt=["value"],vt={value:null},yt=["value"],bt={class:"bottom-actions"},wt=W({__name:"Land",props:{terrainsBackgroundRules:{type:Array,required:!0},terrainsOptions:{type:Object,required:!0},land:{type:Object,required:!0},shape:{type:String,required:!0},showLocations:{type:Boolean,required:!0},showDungeons:{type:Boolean,required:!0},showRotateButton:{type:Boolean,required:!0},showNotesButton:{type:Boolean,required:!0},notesBubbleDirection:{type:String,required:!0}},emits:["dblclick","rotateTerrainClick"],setup(n,{emit:t}){const e=n,r=K(),o=t,p=Q(!1),i=P(()=>e.terrainsBackgroundRules.find(s=>s.appliesFor(e.land))),h=P(()=>{var s;return((s=i.value)==null?void 0:s.backgroundType)==="color"}),x=P(()=>{var s;return((s=i.value)==null?void 0:s.backgroundType)==="image"}),{t:_}=G({useScope:"global"}),O=()=>{o("dblclick")},m=()=>{o("rotateTerrainClick")},g=()=>{p.value=!p.value},v=()=>{p.value=!1},L=M(st,s=>s,s=>_(`location.${s}`)),f=M(at,s=>s,s=>_(`dungeon.${s}`));return(s,l)=>{var H,E,V,j,U;return d(),u("div",{class:w(["land",{"land--current":e.land.isCurrent,[`land--${e.land.terrain}`]:e.land.terrain,[`land--${e.shape}`]:e.shape,[`land--background-type-${(H=i.value)==null?void 0:H.backgroundType}`]:(E=i.value)==null?void 0:E.backgroundType}]),style:Y({backgroundColor:h.value?(V=i.value)==null?void 0:V.background:"transparent ",borderColor:h.value?(j=i.value)==null?void 0:j.background:"transparent"})},[a("div",ut,[a("div",{class:w(["terrain-image",{[`terrain-image--rotation-${e.land.terrainRotation}`]:e.land.terrainRotation}]),style:Y({backgroundImage:x.value?`url(${(U=i.value)==null?void 0:U.background})`:"transparent"})},null,6),a("div",ct,[b(r).showHud?(d(),u(k,{key:0},[S(a("select",{"onUpdate:modelValue":l[0]||(l[0]=c=>e.land.terrain=c)},[a("option",pt,y(`<${s.$t("label.terrain")}>`),1),(d(!0),u(k,null,T(e.terrainsOptions,(c,C,R)=>(d(),u("option",{key:R,value:C},y(c),9,ht))),128))],512),[[A,e.land.terrain]]),e.showLocations?S((d(),u("select",{key:0,"onUpdate:modelValue":l[1]||(l[1]=c=>e.land.location=c)},[a("option",gt,y(`<${s.$t("label.location")}>`),1),(d(!0),u(k,null,T(b(L),(c,C,R)=>(d(),u("option",{key:R,value:C},y(c),9,mt))),128))],512)),[[A,e.land.location]]):B("",!0),e.showDungeons?S((d(),u("select",{key:1,"onUpdate:modelValue":l[2]||(l[2]=c=>e.land.dungeon=c)},[a("option",vt,y(`<${s.$t("label.dungeon")}>`),1),(d(!0),u(k,null,T(b(f),(c,C,R)=>(d(),u("option",{key:R,value:C},y(c),9,yt))),128))],512)),[[A,e.land.dungeon]]):B("",!0)],64)):B("",!0)]),a("div",bt,[b(r).showHud&&e.showRotateButton?(d(),u("div",{key:0,class:"rotate-button",onClick:l[3]||(l[3]=c=>m())})):B("",!0),a("div",{class:"coordinates",onDblclick:l[4]||(l[4]=c=>O())},y(e.land.coordinates.x+" / "+e.land.coordinates.y),33),b(r).showHud&&e.showNotesButton?(d(),u("div",{key:1,class:w(["notes-button",{"notes-button--empty":!e.land.notes}]),onClick:l[5]||(l[5]=c=>g())},null,2)):B("",!0),S(tt(dt,{land:e.land,direction:e.notesBubbleDirection,onHide:l[6]||(l[6]=c=>v()),onClick:l[7]||(l[7]=et(()=>{},["stop"]))},null,8,["land","direction"]),[[Z,p.value]])])])],6)}}}),kt=z(wt,[["__scopeId","data-v-f97347c0"]]);let X=class I{constructor(t){this.lands=t}static ofSize(t){const e=$.at(0,0);e.isCurrent=!0;const r=new I([[e]]);return Array(t-1).fill(void 0).forEach(()=>{r.addTopRow(),r.addRightColumn(),r.addBottomRow(),r.addLeftColumn()}),r}static fromPrimitives(t){return new I(t.lands.map(e=>e.map(r=>$.fromPrimitives(r))))}toPrimitives(){return{lands:this.lands.map(t=>t.map(e=>e.toPrimitives()))}}addTopRow(){const t=this.lands[0][0].coordinates.y-1;this.lands.unshift(this.newRowAt(t))}addBottomRow(){const t=this.lands[this.lands.length-1][0].coordinates.y+1;this.lands.push(this.newRowAt(t))}addLeftColumn(){const t=this.lands[0][0].coordinates.x-1,e=this.lands[0][0].coordinates.y;this.lands.forEach((r,o)=>{r.unshift($.at(t,e+o))})}addRightColumn(){const t=this.lands[0][this.lands[0].length-1].coordinates.x+1,e=this.lands[0][0].coordinates.y;this.lands.forEach((r,o)=>{r.push($.at(t,e+o))})}movePlayersTo(t){this.lands.flat().forEach(e=>{e.isCurrent=e.coordinates.equalsTo(t)})}rotateTerrainAt(t){this.findLandAt(t).rotateTerrain()}findLandAt(t){const e=this.lands.flat().find(r=>r.coordinates.equalsTo(t));if(e===void 0)throw new Error(`Could not find land at ${t}`);return e}newRowAt(t){const e=this.lands[0][0].coordinates.x;return Array(this.lands[0].length).fill(void 0).map((r,o)=>$.at(e+o,t))}};const ft=()=>({save:Ct,get:Rt}),Ct=n=>{localStorage.setItem("world",JSON.stringify(n.toPrimitives()))},Rt=()=>Bt(),Bt=()=>{const n=localStorage.getItem("world");return n?X.fromPrimitives(JSON.parse(n)):null},$t={class:"top"},St={class:"center"},Tt={class:"lands"},qt={class:"bottom"},_t=W({__name:"World",props:{terrainsOptions:{type:Object,required:!0},terrainsBackgroundRules:{type:Array,required:!0},landShape:{type:String,required:!0},showLocations:{type:Boolean,required:!0},showDungeons:{type:Boolean,required:!0},showRotateButton:{type:Boolean,required:!0},showNotesButton:{type:Boolean,required:!0},initialSize:{type:Number,required:!0}},setup(n){const t=n,e=ft(),o=ot(e.get()??X.ofSize(t.initialSize));nt(o,m=>{e.save(m)});const p=()=>{o.addTopRow()},i=()=>{o.addBottomRow()},h=()=>{o.addLeftColumn()},x=()=>{o.addRightColumn()},_=m=>{o.movePlayersTo(m)},O=m=>{o.rotateTerrainAt(m)};return(m,g)=>(d(),u("div",{class:w(["world",{[`world--${t.landShape}`]:t.landShape}])},[a("div",$t,[a("div",{class:"add-button",onClick:g[0]||(g[0]=v=>p())},"+")]),a("div",St,[a("div",{class:w(["add-button",{"add-button--margin-right-square":t.landShape==="square"&&o.lands.length>1,"add-button--margin-right-hexagon":t.landShape==="hexagon"&&o.lands.length>1}]),onClick:g[1]||(g[1]=v=>h())}," + ",2),a("div",Tt,[(d(!0),u(k,null,T(o.lands,(v,L)=>(d(),u("div",{key:L,class:w(["row",{"row--margin-left-square":t.landShape==="square"&&o.lands.length>1,"row--margin-left-hexagon":t.landShape==="hexagon"&&v[0].coordinates.y%2!==0}])},[(d(!0),u(k,null,T(v,(f,s)=>(d(),rt(kt,{key:s,land:f,"terrains-options":n.terrainsOptions,"terrains-background-rules":n.terrainsBackgroundRules,shape:t.landShape,"show-locations":t.showLocations,"show-dungeons":t.showDungeons,"show-rotate-button":t.showRotateButton,"show-notes-button":t.showNotesButton,"notes-bubble-direction":L===0&&o.lands.length>1?b(D).Bottom:b(D).Top,onDblclick:l=>_(f.coordinates),onRotateTerrainClick:l=>O(f.coordinates)},null,8,["land","terrains-options","terrains-background-rules","shape","show-locations","show-dungeons","show-rotate-button","show-notes-button","notes-bubble-direction","onDblclick","onRotateTerrainClick"]))),128))],2))),128))]),a("div",{class:"add-button",onClick:g[2]||(g[2]=v=>x())},"+")]),a("div",qt,[a("div",{class:"add-button",onClick:g[3]||(g[3]=v=>i())},"+")])],2))}}),Pt=z(_t,[["__scopeId","data-v-82e279d6"]]),At=(n,t)=>({appliesFor:n,background:t,backgroundType:"color"}),Nt=(n,t)=>({appliesFor:n,background:t,backgroundType:"image"});export{it as L,Pt as W,At as a,Nt as b,M as c,Ot as d,xt as n};
